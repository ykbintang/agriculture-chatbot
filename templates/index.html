<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8" />
    <title>üåæ Sahabat Tani</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-green-50 min-h-screen flex items-center justify-center p-6">
    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-xl p-8 space-y-6 transition-all duration-300">
        <div class="text-center">
            <h1 class="text-4xl font-extrabold text-green-700 mb-2">üåæ Chatbot Pertanian</h1>
            <p class="text-gray-600">Halo, Sahabat Tani! Tanyakan apa saja seputar pertanian dalam Bahasa Indonesia</p>
        </div>

        <!-- Text Input -->
        <form id="textForm" class="flex gap-3">
            <input type="text" name="text" id="textInput"
                class="flex-1 border border-gray-300 rounded-xl px-5 py-3 text-base focus:outline-none focus:ring-2 focus:ring-green-500"
                placeholder="Contoh: Apa pupuk terbaik untuk padi?" autocomplete="off" />
            <button type="submit"
                class="bg-green-600 hover:bg-green-700 text-white px-5 py-3 rounded-xl text-sm font-semibold transition">
                Kirim
            </button>
        </form>

        <!-- OR Divider -->
        <div class="flex items-center justify-center text-gray-400 gap-2 text-sm font-medium">
            <hr class="flex-grow border-gray-300" />
            atau unggah suara
            <hr class="flex-grow border-gray-300" />
        </div>

        <!-- Audio Upload -->
        <form id="audioForm" enctype="multipart/form-data" class="flex gap-3 items-center">
            <input type="file" name="audio" id="audioInput" accept="audio/*"
                class="flex-1 text-sm border border-gray-300 rounded-xl p-2 file:mr-4 file:py-2 file:px-4 file:rounded-xl file:border-0 file:text-sm file:bg-blue-600 file:text-white hover:file:bg-blue-700 transition" />
            <button type="submit"
                class="bg-blue-600 hover:bg-blue-700 text-white px-5 py-3 rounded-xl text-sm font-semibold transition">
                Unggah
            </button>
        </form>

        <!-- Response Box -->
        <div id="result" class="bg-gray-50 border border-gray-200 p-5 rounded-xl shadow-inner hidden" role="region"
            aria-live="polite">
            <h2 class="font-bold text-lg text-green-800 mb-2">üìù Jawaban:</h2>
            <p id="responseText" class="text-gray-700 mb-3 whitespace-pre-wrap leading-relaxed"></p>
            <audio id="audioPlayer" controls class="w-full hidden rounded-lg"></audio>
        </div>
    </div>

    <script>
        document.getElementById("textForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const text = document.getElementById("textInput").value.trim();
            if (!text) return;

            const formData = new FormData();
            formData.append("text", text);

            try {
                const res = await fetch("/chat", {
                    method: "POST",
                    body: formData,
                });
                const data = await res.json();
                showResponse(data.text, data.voice);
            } catch (err) {
                alert("‚ùå Gagal menghubungi server.");
            }
        });

        document.getElementById("audioForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const fileInput = document.getElementById("audioInput");
            if (!fileInput.files.length) return alert("Silakan pilih file audio.");

            const formData = new FormData();
            formData.append("audio", fileInput.files[0]);

            try {
                const res = await fetch("/chat", {
                    method: "POST",
                    body: formData,
                });
                const data = await res.json();
                showResponse(data.text, data.voice);
            } catch (err) {
                alert("‚ùå Gagal menghubungi server.");
            }
        });

        function showResponse(text, voiceUrl = null) {
            const resultDiv = document.getElementById("result");
            const responseText = document.getElementById("responseText");
            const audioPlayer = document.getElementById("audioPlayer");

            responseText.textContent = text;
            resultDiv.classList.remove("hidden");

            if (voiceUrl) {
                audioPlayer.src = voiceUrl;
                audioPlayer.classList.remove("hidden");
                audioPlayer.load();
            } else {
                audioPlayer.classList.add("hidden");
                audioPlayer.src = "";
            }
        }
    </script>
</body>

</html>